<p-toast></p-toast>
<p-confirmdialog></p-confirmdialog>

<!-- profil student -->
<p-card *ngIf="student$ | async as student" class="profile-card">
  <ng-template #header>
    <div class="profile-header">
      <div class="profile-avatar">
        <i class="pi pi-user"></i>
      </div>
      <div class="profile-info">
        <h2>{{ student.fullName }}</h2>
        <p class="subtitle">{{ student.studyProgramme }}</p>
      </div>
    </div>
  </ng-template>

  <div class="profile-details">
    <div class="detail-item">
      <i class="pi pi-building"></i>
      <div>
        <span class="detail-label">Facultate</span>
        <span class="detail-value">{{ student.faculty }}</span>
      </div>
    </div>
    <div class="detail-item">
      <i class="pi pi-calendar"></i>
      <div>
        <span class="detail-label">An de studiu</span>
        <span class="detail-value">{{ student.yearOfStudy }}</span>
      </div>
    </div>
    <div class="detail-item">
      <i class="pi pi-user-edit"></i>
      <div>
        <span class="detail-label">Tutore</span>
        <span class="detail-value">{{ student.hostTutor }}</span>
      </div>
    </div>
    <div class="detail-item">
      <i class="pi pi-briefcase"></i>
      <div>
        <span class="detail-label">Instituție Gazdă</span>
        <span class="detail-value">{{ student.hostInstitution }}</span>
      </div>
    </div>
    <div class="detail-item">
      <i class="pi pi-clock"></i>
      <div>
        <span class="detail-label">Perioada</span>
        <span class="detail-value">{{ student.internshipPeriod }}</span>
      </div>
    </div>
    <div class="detail-item">
      <i class="pi pi-id-card"></i>
      <div>
        <span class="detail-label">Director Practică</span>
        <span class="detail-value">{{ student.internshipDirector }}</span>
      </div>
    </div>
  </div>
</p-card>

<!-- add/cancel formular -->
<div class="actions-bar">
  <p-button
    [label]="showForm ? 'Anulează' : 'Adaugă Activitate'"
    [icon]="showForm ? 'pi pi-times' : 'pi pi-plus'"
    [severity]="showForm ? 'secondary' : 'primary'"
    (onClick)="toggleForm()">
  </p-button>
</div>

<!-- add/edit formular -->
<p-card *ngIf="showForm"
        [header]="isEditing ? 'Editare Activitate' : 'Înregistrare Nouă'"
        class="form-card">
  <form [formGroup]="activityForm">

    <div class="form-row-3">
      <div class="field">
        <label for="dayNumber">Ziua *</label>
        <p-inputnumber id="dayNumber" formControlName="dayNumber" [min]="1" placeholder="ex: 1" [style]="{'width': '100%'}"></p-inputnumber>
      </div>
      <div class="field">
        <label for="dateOfActivity">Data *</label>
        <p-datepicker id="dateOfActivity" formControlName="dateOfActivity" dateFormat="dd.mm.yy" [showIcon]="true" placeholder="Selectează data" [style]="{'width': '100%'}"></p-datepicker>
      </div>
      <div class="field">
        <label for="timeFrame">Interval Orar *</label>
        <input pInputText id="timeFrame" formControlName="timeFrame" placeholder="ex: 09:00 - 17:00" />
      </div>
    </div>

    <div class="field">
      <label for="venue">Locul Desfășurării *</label>
      <input pInputText id="venue" formControlName="venue" placeholder="ex: Departamentul IT" />
    </div>

    <div class="field">
      <label for="activities">Activități Realizate *</label>
      <textarea pTextarea id="activities" formControlName="activities" rows="3" placeholder="Descrieți activitățile realizate..."></textarea>
    </div>

    <div class="form-row-2">
      <div class="field">
        <label for="equipmentUsed">Echipamente Utilizate</label>
        <textarea pTextarea id="equipmentUsed" formControlName="equipmentUsed" rows="2" placeholder="Laptop, VS Code..."></textarea>
      </div>
      <div class="field">
        <label for="practicedSkills">Competențe Exersate</label>
        <textarea pTextarea id="practicedSkills" formControlName="practicedSkills" rows="2" placeholder="C#, baze de date..."></textarea>
      </div>
    </div>

    <div class="field">
      <label for="personalObservations">Observații Personale</label>
      <textarea pTextarea id="personalObservations" formControlName="personalObservations" rows="2" placeholder="Observații, impresii..."></textarea>
    </div>

    <div class="form-actions">
      <p-button
        *ngIf="isEditing"
        label="Anulează editarea"
        icon="pi pi-times"
        severity="secondary"
        [outlined]="true"
        (onClick)="toggleForm()"
        class="mr-2">
      </p-button>
      <p-button
        [label]="isEditing ? 'Actualizează' : 'Salvează în Jurnal'"
        [icon]="isEditing ? 'pi pi-pencil' : 'pi pi-check'"
        (onClick)="onSave()"
        [disabled]="!activityForm.valid">
      </p-button>
    </div>
  </form>
</p-card>

<!-- tabel activitati -->
<p-card header="Activități Înregistrate" class="table-card">
  <p-table
    [value]="(activities$ | async) || []"
    [paginator]="true"
    [rows]="5"
    [rowsPerPageOptions]="[5, 10, 20]"
    [tableStyle]="{'min-width': '60rem'}"
    class="p-datatable-striped">

    <ng-template #header>
      <tr>
        <th style="width: 60px">Ziua</th>
        <th style="width: 110px">Data</th>
        <th style="width: 120px">Interval</th>
        <th>Locație</th>
        <th>Activități</th>
        <th>Echipament</th>
        <th>Competențe</th>
        <th>Observații</th>
        <th style="width: 100px">Acțiuni</th>
      </tr>
    </ng-template>

    <ng-template #body let-activity>
      <tr>
        <td>{{ activity.dayNumber }}</td>
        <td>{{ activity.dateOfActivity | date:'dd.MM.yyyy' }}</td>
        <td>{{ activity.timeFrame }}</td>
        <td>{{ activity.venue }}</td>
        <td>{{ activity.activities }}</td>
        <td>{{ activity.equipmentUsed }}</td>
        <td>{{ activity.practicedSkills }}</td>
        <td>{{ activity.personalObservations }}</td>
        <td>
          <div class="action-buttons">
            <p-button
              icon="pi pi-pencil"
              severity="info"
              [rounded]="true"
              [text]="true"
              (onClick)="onEdit(activity)"
              pTooltip="Editează">
            </p-button>
            <p-button
              icon="pi pi-trash"
              severity="danger"
              [rounded]="true"
              [text]="true"
              (onClick)="onDelete(activity)"
              pTooltip="Șterge">
            </p-button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template #emptymessage>
      <tr>
        <td colspan="9" style="text-align: center; padding: 2rem;">
          <i class="pi pi-inbox" style="font-size: 2rem; color: #94a3b8;"></i>
          <p style="color: #64748b;">Nu există activități înregistrate încă.</p>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-card>
