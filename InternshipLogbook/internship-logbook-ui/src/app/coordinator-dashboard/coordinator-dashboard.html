<div class="dashboard-container">

  <p-card class="coordinator-profile-card">
    <ng-template #header>
      <div class="profile-header-gradient">
        <div class="profile-avatar">
          <i class="pi pi-user-edit"></i>
        </div>
        <div class="profile-info">
          <h2>{{ (authService.user$ | async)?.fullName || 'Nume Indisponibil' }}</h2>
          <p class="subtitle">Coordonator Stagii Practică - IESC</p>
        </div>
        <div class="header-actions">
          <p-button label="Ieșire" icon="pi pi-sign-out" severity="danger" [outlined]="true" (onClick)="logout()"></p-button>
        </div>
      </div>
    </ng-template>

    <div class="profile-summary-bar">
      <div class="summary-item">
        <i class="pi pi-users"></i>
        <span><strong>{{ students.length }}</strong> Studenți Arondați</span>
      </div>
      <div class="summary-item">
        <i class="pi pi-check-circle"></i>
        <span><strong>1</strong> Stagiu Finalizat</span>
      </div>
    </div>
  </p-card>

  <h3 class="section-title"><i class="pi pi-list"></i> Studenți în Coordonare</h3>

  <div class="students-grid">
    @for (student of students; track student.id) {
      <p-card class="student-item-card">
        <div class="student-card-header">
          <div class="student-basic-info">
            <span class="student-name">{{ student.name }}</span>
            <p-tag [value]="student.status" [severity]="getSeverity(student.status)" [rounded]="true"></p-tag>
          </div>
          <p-button
            label="Vezi Jurnal"
            icon="pi pi-arrow-right"
            iconPos="right"
            [text]="true"
            (onClick)="viewJournal(student)">
          </p-button>
        </div>

        <div class="student-details">
          <div class="detail-item">
            <i class="pi pi-envelope"></i>
            <div>
              <span class="detail-label">Email</span>
              <span class="detail-value">{{ student.email }}</span>
            </div>
          </div>
          <div class="detail-item">
            <i class="pi pi-briefcase"></i>
            <div>
              <span class="detail-label">Companie</span>
              <span class="detail-value">{{ student.company }}</span>
            </div>
          </div>
          <div class="detail-item">
            <i class="pi pi-chart-bar"></i>
            <div>
              <span class="detail-label">Progres</span>
              <span class="detail-value progress-value">{{ student.progress }}%</span>
            </div>
          </div>
        </div>

        <div class="progress-bar-container">
          <div class="progress-bar" [style.width.%]="student.progress"></div>
        </div>
      </p-card>
    }
  </div>
</div>

<p-dialog
  [(visible)]="displayJournal"
  [header]="'Jurnal de Practică - ' + selectedStudentName"
  [modal]="true"
  [style]="{width: '90vw', maxWidth: '900px'}"
  [maximizable]="true"
  [draggable]="false"
  [resizable]="false"
  [breakpoints]="{'768px': '95vw'}">

  <div class="journal-desktop">
    <p-table [value]="selectedStudentActivities" [paginator]="true" [rows]="5"
             class="p-datatable-striped">
      <ng-template #header>
        <tr>
          <th style="width: 60px">Ziua</th>
          <th style="width: 100px">Data</th>
          <th style="width: 100px">Interval</th>
          <th>Locație</th>
          <th>Activitate</th>
        </tr>
      </ng-template>
      <ng-template #body let-activity>
        <tr>
          <td><span class="day-badge-sm">{{ activity.dayNumber }}</span></td>
          <td>{{ activity.dateOfActivity | date:'dd.MM.yyyy' }}</td>
          <td>{{ activity.timeFrame }}</td>
          <td>{{ activity.venue }}</td>
          <td class="cell-wrap">{{ activity.activities }}</td>
        </tr>
      </ng-template>
      <ng-template>
        <tr>
          <td colspan="5" class="empty-journal">
            <i class="pi pi-inbox"></i>
            <p>Studentul nu are activități înregistrate.</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <div class="journal-mobile">
    @if (selectedStudentActivities.length === 0) {
      <div class="empty-journal">
        <i class="pi pi-inbox"></i>
        <p>Studentul nu are activități înregistrate.</p>
      </div>
    }
    @for (activity of selectedStudentActivities; track activity.id) {
      <div class="journal-card">
        <div class="journal-card-header">
          <span class="day-badge-sm">{{ activity.dayNumber }}</span>
          <span class="journal-date">{{ activity.dateOfActivity | date:'dd.MM.yyyy' }}</span>
          <span class="journal-time">{{ activity.timeFrame }}</span>
        </div>
        <div class="journal-card-body">
          <div class="journal-row">
            <i class="pi pi-map-marker"></i>
            <span>{{ activity.venue }}</span>
          </div>
          <div class="journal-row">
            <i class="pi pi-list"></i>
            <span>{{ activity.activities }}</span>
          </div>
        </div>
      </div>
    }
  </div>

  <ng-template #footer>
    <p-button icon="pi pi-times" (onClick)="displayJournal=false" label="Închide" severity="secondary" [outlined]="true"></p-button>
  </ng-template>
</p-dialog>
